<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMT Initial Dominance: Chiang's Fatal Strategy (1945–1946)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            position: relative;
        }
        
        /* Fixed background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 76, 153, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 102, 204, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Custom colors matching the main page's NHD theme */
        .nhd-blue { background-color: #004c99; }
        .text-nhd-blue { color: #004c99; }
        .border-nhd-blue { border-color: #004c99; }
        .nhd-light-blue { background-color: #e6f0ff; }
        .nhd-gold { background-color: #ffc72c; }
        .hover\:bg-nhd-blue\/90:hover { background-color: rgba(0, 76, 153, 0.9); }

        .failure-box {
            border-left: 5px solid #dc2626;
            background-color: #fef2f2;
        }
        
        /* Enhanced card container */
        .card-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 76, 153, 0.15);
            border-radius: 28px;
            box-shadow: 0 30px 70px rgba(0, 76, 153, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        
        .card-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(0, 76, 153, 0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Back button enhancement */
        .back-button {
            transition: all 0.3s ease;
            color: #004c99;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            background: rgba(0, 76, 153, 0.05);
        }
        
        .back-button:hover {
            color: #0066cc;
            background: rgba(0, 76, 153, 0.12);
            transform: translateX(-6px);
            box-shadow: 0 4px 12px rgba(0, 76, 153, 0.15);
        }
        
        /* Heading styles */
        h1 {
            background: linear-gradient(135deg, #004c99 0%, #0066cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            font-size: 2rem;
            font-weight: 900;
            line-height: 1.2;
            position: relative;
            z-index: 1;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }
        
        @media (min-width: 640px) {
            h1 { font-size: 2.5rem; }
        }
        
        @media (min-width: 768px) {
            h1 { font-size: 3rem; }
        }
        
        /* Header container */
        .mt-8 h1 {
            display: block;
            width: 100%;
        }
        
        h2 {
            border-left: 5px solid #004c99;
            padding-left: 16px;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            font-weight: 800;
            color: #1a3a52;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }
        
        h2:hover {
            border-left-color: #0066cc;
            padding-left: 20px;
            transform: translateX(4px);
        }
        
        h3 {
            color: #004c99;
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        
        /* Content box styling */
        .content-box {
            background: linear-gradient(135deg, #e6f0ff 0%, #f0f7ff 100%);
            border: 2px solid rgba(0, 76, 153, 0.15);
            border-radius: 18px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .content-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }
        
        .content-box:hover::before {
            left: 100%;
        }
        
        .content-box:hover {
            border-color: rgba(0, 76, 153, 0.35);
            box-shadow: 0 15px 40px rgba(0, 76, 153, 0.15);
            transform: translateY(-4px);
        }
        
        /* List item styling */
        ul li {
            transition: all 0.2s ease;
            padding: 0.5rem 0;
            position: relative;
            padding-left: 0.5rem;
        }
        
        ul li:hover {
            color: #004c99;
            padding-left: 1rem;
        }
        
        ul li strong {
            color: #004c99;
            font-weight: 700;
        }
        
        /* Link styling */
        a {
            color: #004c99;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
        }
        
        a:hover {
            color: #0066cc;
        }
        
        a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #004c99, #0066cc);
            transition: width 0.3s ease;
        }
        
        a:hover::after {
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen py-8 sm:py-12 px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16">
    <nav class="top-nav flex items-center justify-between py-4 px-4 sm:px-6 md:px-8" aria-label="Main navigation">
        <span class="text-sm sm:text-base font-extrabold text-nhd-blue tracking-tight">Chinese Civil War (1945–1949)</span>
        <div class="flex items-center space-x-4 sm:space-x-6 text-sm sm:text-base">
            <a href="index.html#timeline" class="hover:text-blue-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-nhd-blue">Timeline</a>
            <a href="index.html#comparison" class="hover:text-blue-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-nhd-blue">Comparison</a>
            <a href="summary.html" class="hover:text-blue-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-nhd-blue">Summary</a>
            <a href="sources.html" class="hover:text-blue-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-nhd-blue">Sources</a>
        </div>
    </nav>

    <div class="card-container bg-white p-8 sm:p-12 w-full max-w-6xl mx-auto" role="main">
        <a href="#main-content" class="sr-only focus:not-sr-only focus:block focus:p-2 focus:bg-nhd-blue focus:text-white focus:rounded focus:outline-2 focus:outline-offset-2 focus:outline-nhd-blue">Skip to main content</a>
        
        <a href="index.html" 
            class="back-button inline-flex items-center text-sm font-bold hover:text-blue-800 transition duration-150 group focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-nhd-blue">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform duration-200">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Back to Timeline
        </a>

        <div class="mt-8 border-b-2 border-nhd-blue/20 pb-6">
            <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight">KMT Initial Dominance: Chiang's Fatal Strategy (1945–1946)</h1>
            <p class="mt-3 text-gray-600 text-lg leading-relaxed">At the end of World War II, the Nationalists, backed by major U.S. aid, looked unbeatable. But the way Chiang Kai-shek used that advantage planted the seeds of later defeat.</p>
        </div>

        <div id="main-content" class="mt-10 space-y-8">
            <section class="content-box p-7 nhd-light-blue rounded-xl border border-nhd-blue/50 space-y-4">
                <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-nhd-blue pl-3">Strong on Paper, Weak on the Ground</h2>
                <p class="text-gray-700 leading-relaxed">
                    Chiang focused on "positional warfare"—seizing big cities, rail hubs, and industrial areas, then defending them with large garrisons and U.S.-supplied weapons. U.S. ships and planes moved more than half a million KMT troops into North China and Manchuria, giving the Nationalists an early map advantage. But cities were islands; the CCP still dominated most villages and back roads.
                </p>
            </section>

            <figure class="bg-white rounded-xl border border-nhd-blue/30 p-5 shadow-md flex flex-col items-center space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                    <img src="img/image (4).png" alt="KMT forces advancing during 1945–46" class="w-full rounded-lg shadow-md object-cover">
                    <img src="img/image (5).png" alt="Map of KMT territorial gains, 1945–46" class="w-full rounded-lg shadow-md object-cover">
                </div>
                <figcaption class="text-sm text-gray-600 text-center max-w-2xl">
                    KMT forces pushing for an offensive and gain in territory during 1945–46, which ultimately led to fast usage of their resources.
                </figcaption>
            </figure>

            <section class="content-box p-7 bg-white rounded-xl border border-nhd-blue/30 space-y-3">
                <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-nhd-blue pl-3">Overstretch and Corruption</h2>
                <p class="text-gray-700 leading-relaxed">
                    Elite KMT units were pushed deep into Manchuria, tied to long, vulnerable rail lines. Communist guerrillas blew up tracks and bridges, forcing constant repairs. At the same time, runaway inflation and corruption inside the Nationalist government gutted soldier morale and ruined middle‑class savings. Supplies disappeared into black markets, and conscription and grain taxes turned many villagers against the KMT.
                </p>
            </section>

            <section class="content-box p-7 nhd-light-blue rounded-xl border border-nhd-blue/50 space-y-3">
                <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-nhd-blue pl-3">From Advantage to Stalemate</h2>
                <p class="text-gray-700 leading-relaxed">
                    By late 1946, Nationalist forces still held most major cities but were stuck. Garrison duty tied down their best units, while desertions and supply crises steadily weakened them. The Communists avoided big set‑piece battles, instead wearing the KMT down with rail sabotage and political work in the countryside.</p>
                <p class="text-gray-700 leading-relaxed">
                    In terms of our theme, the KMT tried to complete its revolution through force and foreign support, but popular reaction to inflation, corruption, and harsh conscription hollowed out that effort. At the same time, CCP land and propaganda campaigns in the villages offered a reform agenda that many Chinese found more believable.
                </p>
            </section>
        </div>
    </div>
    
    <div id="message-box" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold text-nhd-blue mb-3">Notice</h3>
            <p id="message-content" class="text-gray-700"></p>
            <button class="mt-4 w-full nhd-blue text-white py-2 rounded-lg hover:bg-blue-800 transition" 
                        onclick="document.getElementById('message-box').classList.add('hidden'); document.getElementById('message-box').classList.remove('flex');">
                Close
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;

        // Initialize Firebase
        try {
            if (Object.keys(firebaseConfig).length > 0) {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } else {
                console.error("Firebase configuration is missing.");
            }
        } catch (e) {
            console.error("Error initializing Firebase:", e);
        }

        /**
         * Custom message box function to comply with the no-alert rule.
         */
        function showCustomMessage(message, title = 'Notice') {
            const msgBox = document.getElementById('message-box');
            document.querySelector('#message-box h3').textContent = title;
            document.getElementById('message-content').innerHTML = message;
            msgBox.classList.remove('hidden');
            msgBox.classList.add('flex');
        }

        /**
         * Handles user authentication using the provided token or anonymously.
         * @returns {string | null} The user ID if successful, otherwise null.
         */
        async function initializeAuth() {
            if (!auth) return null;
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                return auth.currentUser.uid;
            } catch (error) {
                console.error("Firebase Auth Error:", error);
                return null;
            }
        }

        /**
         * Saves the completion status of Part 2 to Firestore.
         */
        window.confirmCompletion = async function() {
            const confirmButton = document.getElementById('confirm-button');
            confirmButton.disabled = true;
            confirmButton.textContent = 'Saving Progress...';

            if (!db) {
                showCustomMessage("Database not configured. Cannot save progress.", "Error");
                confirmButton.disabled = false;
                confirmButton.textContent = 'Confirm Read of Part 2';
                return;
            }

            const userId = await initializeAuth();
            if (!userId) {
                showCustomMessage("Failed to authenticate user. Cannot save progress.", "Error");
                confirmButton.disabled = false;
                confirmButton.textContent = 'Confirm Read of Part 2';
                return;
            }

            // Path to store the completion status for Part 2 in the user's private space
            const docPath = `/artifacts/${appId}/users/${userId}/progress/part2_completed`;
            const progressRef = doc(db, docPath);

            try {
                await setDoc(progressRef, {
                    completed: true,
                    timestamp: new Date(),
                    part: 2
                });
                
                showCustomMessage(
                    'Your reading progress for **Part 2** has been saved. The next section on your Timeline is now unlocked!', 
                    'Part 2 Confirmed & Unlocked'
                );
                
                // Update button appearance to show success
                confirmButton.textContent = 'Part 2 Confirmed!';
                confirmButton.classList.remove('bg-gray-300', 'hover:bg-gray-400', 'text-gray-800');
                confirmButton.classList.add('bg-green-600', 'hover:bg-green-700', 'text-white');

            } catch (e) {
                console.error("Error writing document: ", e);
                showCustomMessage(`An error occurred while saving: ${e.message}`, "Database Error");
                confirmButton.disabled = false;
            }
        }
    </script>

</body>
</html>
