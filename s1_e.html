<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-War Standoff: The Race for Territory (1945)</title>
    <link rel="icon" href="favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            position: relative;
        }
        
        /* Fixed background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 76, 153, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 102, 204, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Custom colors matching the main page's NHD theme */
        .nhd-blue { background-color: #004c99; }
        .text-nhd-blue { color: #004c99; }
        .border-nhd-blue { border-color: #004c99; }
        .nhd-light-blue { background-color: #e6f0ff; }
        .nhd-gold { background-color: #ffc72c; }
        .hover\:bg-nhd-blue\/90:hover { background-color: rgba(0, 76, 153, 0.9); }

        /* Style for loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #004c99;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Enhanced card container */
        .card-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 76, 153, 0.15);
            border-radius: 28px;
            box-shadow: 0 30px 70px rgba(0, 76, 153, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        
        .card-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(0, 76, 153, 0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Back button enhancement */
        .back-button {
            transition: all 0.3s ease;
            color: #004c99;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            background: rgba(0, 76, 153, 0.05);
        }
        
        .back-button:hover {
            color: #0066cc;
            background: rgba(0, 76, 153, 0.12);
            transform: translateX(-6px);
            box-shadow: 0 4px 12px rgba(0, 76, 153, 0.15);
        }
        
        /* Heading styles */
        h1 {
            background: linear-gradient(135deg, #004c99 0%, #0066cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            font-size: 2rem;
            font-weight: 900;
            line-height: 1.2;
            position: relative;
            z-index: 1;
        }
        
        @media (min-width: 640px) {
            h1 { font-size: 2.5rem; }
        }
        
        @media (min-width: 768px) {
            h1 { font-size: 3rem; }
        }
        
        h2 {
            border-left: 5px solid #004c99;
            padding-left: 16px;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            font-weight: 800;
            color: #1a3a52;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }
        
        h2:hover {
            border-left-color: #0066cc;
            padding-left: 20px;
            transform: translateX(4px);
        }
        
        h3 {
            color: #004c99;
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        
        /* Content box styling */
        .content-box {
            background: linear-gradient(135deg, #e6f0ff 0%, #f0f7ff 100%);
            border: 2px solid rgba(0, 76, 153, 0.15);
            border-radius: 18px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .content-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }
        
        .content-box:hover::before {
            left: 100%;
        }
        
        .content-box:hover {
            border-color: rgba(0, 76, 153, 0.35);
            box-shadow: 0 15px 40px rgba(0, 76, 153, 0.15);
            transform: translateY(-4px);
        }
        
        /* List item styling */
        ul li {
            transition: all 0.2s ease;
            padding: 0.5rem 0;
            position: relative;
            padding-left: 0.5rem;
        }
        
        ul li:hover {
            color: #004c99;
            padding-left: 1rem;
        }
        
        ul li strong {
            color: #004c99;
            font-weight: 700;
        }
        
        /* Link styling */
        a {
            color: #004c99;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
        }
        
        a:hover {
            color: #0066cc;
        }
        
        a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #004c99, #0066cc);
            transition: width 0.3s ease;
        }
        
        a:hover::after {
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6">

    <div class="card-container bg-white p-8 sm:p-12 w-full max-w-2xl">
        
        <a href="index.html" 
            class="back-button inline-flex items-center text-sm font-bold hover:text-blue-800 transition duration-150 group">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform duration-200">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Back to Timeline
        </a>

        <div class="mt-8 border-b-2 border-nhd-blue/20 pb-6">
            <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight">Post-War Standoff: The Race for Territory (1945)</h1>
            <p class="mt-3 text-gray-600 text-lg leading-relaxed max-w-2xl">Right after World War II ended, the Nationalist and Communist forces started fighting again really quickly.</p>
        </div>

        <div class="mt-10 space-y-8">
            <h2 class="text-2xl font-bold text-gray-800">The Power Vacuum</h2>
            
            <div class="content-box p-7 nhd-light-blue rounded-xl border border-nhd-blue/50">
                <h3 class="text-lg font-semibold text-nhd-blue mb-3">The Big Prize: Manchuria</h3>
                <p class="text-gray-700 leading-relaxed">
                    When Japan suddenly gave up in August 1945, it left a huge power vacuum across China. The shaky peace between the Nationalists (KMT) and the Communists (CCP) fell apart immediately. Both sides raced to take over cities Japan had controlled and grab their huge stockpiles of modern weapons. Manchuria, which had lots of resources, became the main battlefield because it was important for factories and controlling territory.
                </p>
                
                <ul class="list-disc pl-6 mt-5 text-gray-700 space-y-3 leading-relaxed">
                    <li><strong>Nationalist Strategy:</strong> Tried to take back control of big cities in central and southern China. They depended on U.S. planes and ships to move their troops quickly into these important cities.</li>
                    <li><strong>Communist Strategy:</strong> Focused on taking over the countryside and controlling railroad lines going into Manchuria. They got important help and grabbed tons of Japanese weapons from the Soviet troops who were there.</li>
                    <li><strong>Failed Peace Talks:</strong> General George C. Marshall tried to get Chiang Kai-shek and Mao Zedong to stop fighting in late 1945, but they didn't trust each other and both wanted to grab territory, so peace talks didn't work.</li>
                </ul>
            </div>

            <div class="content-box p-7 bg-white rounded-xl border border-nhd-blue/30">
                <h3 class="text-lg font-semibold text-nhd-blue mb-3">Railroads, Ports, and Airlifts (Fall 1945)</h3>
                <p class="text-gray-700 leading-relaxed">
                    Controlling transportation routes decided who could hold the cities captured from Japan. The Nationalists used U.S. planes (Operation BELEAGUER) to fly troops into Beijing, Tianjin, and Shanghai, while U.S. Navy ships brought more troops to important ports. The Communists focused on cutting railroad lines south of Manchuria, blowing up the Jinzhou–Shenyang–Changchun rail lines to slow down Nationalist advances and trap their garrisons.
                </p>
                <ul class="list-disc pl-6 mt-4 text-gray-700 space-y-3 leading-relaxed">
                    <li><strong>U.S. transport help:</strong> More than 500,000 Nationalist troops were moved by U.S. ships and planes between September and December 1945, giving the Nationalists an early advantage.</li>
                    <li><strong>Railroad problems:</strong> Communist units destroyed bridges on the South Manchuria Railway and attacked repair crews, forcing Nationalist armies to move forward without reliable supplies.</li>
                    <li><strong>Cities vs. countryside:</strong> The Nationalists held major cities and railroad hubs; the Communists controlled the countryside around them, setting up future siege battles in 1946.</li>
                </ul>
            </div>

            <div class="content-box p-7 nhd-light-blue rounded-xl border border-nhd-blue/50">
                <h3 class="text-lg font-semibold text-nhd-blue mb-3">Soviet Withdrawal and Captured Arsenals</h3>
                <p class="text-gray-700 leading-relaxed">
                    Soviet forces occupied Manchuria until early 1946, stripping factories but leaving massive Japanese stockpiles. As the Red Army withdrew, local CCP forces inherited large quantities of rifles, artillery, and machine tools, enabling rapid expansion of the PLA’s Manchurian field armies.
                </p>
                <ul class="list-disc pl-6 mt-4 text-gray-700 space-y-3 leading-relaxed">
                    <li><strong>Weapons windfall:</strong> Tens of thousands of Japanese small arms and heavy weapons were transferred (or seized) by CCP units, closing the firepower gap with the KMT.</li>
                    <li><strong>Industrial base:</strong> Machine shops in Shenyang and Harbin were retooled to repair captured equipment, giving the PLA a sustainable supply line by 1946.</li>
                    <li><strong>Timing:</strong> Soviet withdrawal in early 1946 coincided with the Marshall Mission ceasefire, allowing the CCP to consolidate gains before major Nationalist offensives resumed.</li>
                </ul>
            </div>

            <div class="content-box p-7 bg-white rounded-xl border border-nhd-blue/30">
                <h3 class="text-lg font-semibold text-nhd-blue mb-3">Ceasefire, Talks, and Breakdown</h3>
                <p class="text-gray-700 leading-relaxed">
                    The January 10, 1946 ceasefire and subsequent Political Consultative Conference produced agreements on a coalition government and troop redeployments, but both sides maneuvered to improve their positions. Skirmishes never stopped in Manchuria, and competing claims over rail hubs led to escalating clashes by spring 1946.
                </p>
                <ul class="list-disc pl-6 mt-4 text-gray-700 space-y-3 leading-relaxed">
                    <li><strong>Trust deficit:</strong> Each side accused the other of violating troop ceilings and moving forces under the guise of “reorganization.”</li>
                    <li><strong>Manchuria exception:</strong> The ceasefire terms were vague about Manchuria, allowing continuous fighting that undercut nationwide truce efforts.</li>
                    <li><strong>Outcome:</strong> By summer 1946, large-scale operations resumed, marking the transition from uneasy truce to full civil war.</li>
                </ul>
            </div>
            
            <div class="pt-4 border-t border-gray-200">
                <label for="prompt-input" class="block text-lg font-bold text-gray-800 mb-2">Dive Deeper: Research a Historical Term</label>
                <p class="text-sm text-gray-600 mb-3">Ask about specific events or figures (e.g., "What was the Marshall Mission?" or "Describe the Soviet role in Manchuria").</p>
                <textarea id="prompt-input" placeholder="Enter your historical question here..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-nhd-blue focus:border-nhd-blue transition duration-150 h-24 resize-none"></textarea>
            </div>

            <div id="results-output" class="hidden mt-4 p-4 rounded-xl border-2 border-nhd-gold/50 bg-nhd-gold/10">
                <h3 class="text-md font-extrabold text-nhd-blue mb-2 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21 12 13.5H3.75z" />
                    </svg>
                    AI Research Result
                </h3>
            </div>
            
            <div id="loading-indicator" class="hidden flex justify-center items-center py-4">
                <div class="spinner"></div>
                <span class="ml-3 text-nhd-blue font-medium">Generating Answer...</span>
            </div>

            <button id="search-button"
                class="w-full nhd-blue hover:bg-nhd-blue/90 text-white font-bold py-3 px-4 rounded-xl transition duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center space-x-2"
                onclick="fetchHistoricalData()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <span>Run Historical Search</span>
        </div>
    </div>
    
    <div id="message-box" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold text-nhd-blue mb-3">Notice</h3>
            <p id="message-content" class="text-gray-700"></p>
            <button class="mt-4 w-full nhd-blue text-white py-2 rounded-lg hover:bg-blue-800 transition" 
                    onclick="document.getElementById('message-box').classList.add('hidden'); document.getElementById('message-box').classList.remove('flex');">
                Close
            </button>
        </div>
    </div>

    <script>
        // NOTE: The __app_id, __firebase_config, and __initial_auth_token are provided automatically by the environment.
        const apiKey = "AIzaSyBcXBwA8dpsfOvqeZ1gLUGVHA-FPoZm1WI"; // Canvas will provide this key in runtime
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=" + apiKey;

        // Custom message box function to comply with the no-alert rule
        function showCustomMessage(message, title = 'Notice') {
            const msgBox = document.getElementById('message-box');
            document.querySelector('#message-box h3').textContent = title;
            document.getElementById('message-content').innerHTML = message;
            msgBox.classList.remove('hidden');
            msgBox.classList.add('flex');
        }

        async function fetchHistoricalData(retryCount = 0) {
            const prompt = document.getElementById('prompt-input').value.trim();
            const resultsOutput = document.getElementById('results-output');
            const loadingIndicator = document.getElementById('loading-indicator');
            const searchButton = document.getElementById('search-button');
            const maxRetries = 3;

            if (!prompt) {
                showCustomMessage('Please enter a term or question to search.', 'Input Required');
                return;
            }

            // UI updates for loading state
            resultsOutput.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            searchButton.disabled = true;
            searchButton.innerHTML = '<div class="spinner !border-l-white"></div><span class="ml-3">Searching...</span>';

            const systemPrompt = "You are a specialized history tutor focused on the Chinese Civil War (1945-1949). Provide a concise, clear, and highly focused response to the user's query, ensuring your answer is directly relevant to the historical context of the conflict and uses the provided search results for grounding. The response must be a single, short paragraph.";

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && retryCount < maxRetries) {
                    // Exponential backoff
                    const delay = Math.pow(2, retryCount) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchHistoricalData(retryCount + 1);
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                let outputText = "<p class='text-gray-700'>No information found. Please try a different query.</p>";
                let sourcesHtml = "";

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    
                    // Extract and format grounding sources
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        const sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                        
                        if (sources.length > 0) {
                            sourcesHtml = '<p class="text-xs font-semibold text-gray-600 mt-3 mb-1">Sources:</p><ul class="list-disc pl-5 text-xs text-gray-600 space-y-1">';
                            sources.forEach((source, index) => {
                                sourcesHtml += `<li><a href="${source.uri}" target="_blank" class="hover:underline text-nhd-blue">${source.title}</a></li>`;
                            });
                            sourcesHtml += '</ul>';
                        }
                    }

                    outputText = `<p class="text-gray-800 font-medium">${text}</p>${sourcesHtml}`;
                }

                resultsOutput.innerHTML = outputText;
                resultsOutput.classList.remove('hidden');

            } catch (error) {
                console.error("Gemini API Error:", error);
                showCustomMessage(`An error occurred while fetching data: <code>${error.message}</code>`, 'API Error');
            } finally {
                // UI updates for completion
                loadingIndicator.classList.add('hidden');
                searchButton.disabled = false;
                searchButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                                          </svg>
                                          <span>Run Historical Search</span>`;
            }
        }
    </script>

</body>
</html>
